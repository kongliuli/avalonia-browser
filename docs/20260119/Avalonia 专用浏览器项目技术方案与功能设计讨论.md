# Avalonia ä¸“ç”¨æµè§ˆå™¨é¡¹ç›®æŠ€æœ¯æ–¹æ¡ˆä¸åŠŸèƒ½è®¾è®¡è®¨è®º

## é¡¹ç›®æ¦‚è¿°ä¸å®šä½

å’±ä»¬è¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒç›®æ ‡æ˜¯æ‰“é€ ä¸€ä¸ª**é›†æˆå¤šä¸ªå…è´¹ AI Agent çš„æ¡Œé¢åº”ç”¨**ï¼Œé€šè¿‡éšè—æµè§ˆå™¨ç•Œé¢ï¼Œæä¾›ç±»ä¼¼ IDE å·¥å…·é£æ ¼çš„ç»Ÿä¸€äº¤äº’ä½“éªŒã€‚ç”¨æˆ·å¯ä»¥åˆ‡æ¢ä¸åŒçš„"å¿ƒæ™ºæ¨¡å¼"ï¼ˆè§’è‰²ï¼‰ï¼Œåœ¨ç»Ÿä¸€çš„ç•Œé¢ä¸‹ä¸å¤šä¸ª AI æœåŠ¡äº¤äº’ï¼Œå¹¶èƒ½å¤Ÿå­˜æ¡£å’Œç®¡ç†å¯¹è¯å†…å®¹ç”¨äºçŸ¥è¯†åº“æ„å»ºã€‚

è¿™ä¸ªå®šä½å¾ˆæœ‰æ„æ€â€”â€”æ—¢ä¸æ˜¯ç®€å•çš„æµè§ˆå™¨å£³å­ï¼Œä¹Ÿä¸æ˜¯çº¯ç²¹çš„èŠå¤©åº”ç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ª**AI å·¥ä½œæµæ•´åˆå¹³å°**ã€‚Avalonia UI æ¡†æ¶ä¸ºæˆ‘ä»¬å®ç°è¿™ä¸ªç›®æ ‡æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚

---

## ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© Avalonia UI æ¡†æ¶ï¼Ÿ

### 1.1 è·¨å¹³å°èƒ½åŠ›æ˜¯å…³é”®ä¼˜åŠ¿

Avalonia æœ€å¤§çš„äº®ç‚¹æ˜¯**çœŸæ­£çš„è·¨å¹³å°æ”¯æŒ**ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºå®è·µï¼Œå®ƒæ”¯æŒï¼š
- **æ¡Œé¢ç«¯**ï¼šWindowsã€macOSã€Linuxï¼ˆåŒ…æ‹¬å›½äº§éº’éºŸã€ç»Ÿä¿¡ UOSï¼‰[0â€ ]
- **ç§»åŠ¨ç«¯**ï¼šAndroidã€iOS
- **WebAssembly**ï¼šå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ

è¿™æ„å‘³ç€æˆ‘ä»¬ç¼–å†™ä¸€ä»½ XAML/C# ä»£ç ï¼Œå°±èƒ½åœ¨æ‰€æœ‰ä¸»æµå¹³å°ä¸Šè¿è¡Œï¼Œè¿™å¯¹äºè¦†ç›–ä¸åŒç”¨æˆ·ç¾¤ä½“éå¸¸é‡è¦ã€‚

### 1.2 ç±» WPF çš„å¼€å‘ä½“éªŒï¼Œæ€§èƒ½æ›´ä¼˜

Avalonia é‡‡ç”¨ **Skia æ¸²æŸ“å¼•æ“**ï¼ˆChrome å’Œ Android åŒæ¬¾ï¼‰ï¼Œè¿™å¸¦æ¥äº†å‡ ä¸ªä¼˜åŠ¿ï¼š
- **é«˜æ€§èƒ½**ï¼šç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ï¼Œæµç•…çš„åŠ¨ç”»æ•ˆæœ [10â€ ]
- **åƒç´ çº§æ§åˆ¶**ï¼šç±»ä¼¼ Qt çš„åº•å±‚èƒ½åŠ›ï¼Œä½†æ›´ç°ä»£åŒ–
- **ç°ä»£ API**ï¼šæ”¯æŒ .NET 8/10 çš„æœ€æ–°ç‰¹æ€§ï¼Œå¦‚ Source Generators [66â€ ]

### 1.3 ä¸°å¯Œçš„ä¸»é¢˜å’Œæ ·å¼ç³»ç»Ÿ

è¿™å¯¹æˆ‘ä»¬çš„"å·¥å…·é£æ ¼ UI"è‡³å…³é‡è¦ï¼š
- **Fluent Design**ï¼šå—å¾®è½¯ Fluent Design System å¯å‘ï¼Œæä¾›ç°ä»£ã€æ¸…æ™°çš„ç¾å­¦ [27â€ ]
- **æš—è‰²/äº®è‰²ä¸»é¢˜**ï¼šå†…ç½®æ”¯æŒï¼Œå¯è½»æ¾åˆ‡æ¢
- **å¼ºå¤§çš„æ ·å¼ç³»ç»Ÿ**ï¼šæ”¯æŒ CSS ç±»ä¼¼çš„è¯­æ³•ï¼Œè®¾è®¡å¸ˆå¯ä»¥ç‹¬ç«‹å®šä¹‰æ ·å¼ [10â€ ]

**å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ**ï¼š
- **WPF**ï¼šä»… Windowsï¼Œä¸” WebView æ§ä»¶è€æ—§
- **Electron**ï¼šä½“ç§¯å¤§ï¼ˆ>100MBï¼‰ï¼Œæ€§èƒ½å·®ï¼Œå­¦ä¹  JavaScript/TypeScript æˆæœ¬é«˜
- **Tauri**ï¼šéœ€è¦ Rust åç«¯ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­
- **.NET MAUI**ï¼šç§»åŠ¨ç«¯ä¼˜å…ˆï¼Œæ¡Œé¢ç«¯ WebView æ§ä»¶æœ‰é™åˆ¶

---

## äºŒã€WebView åµŒå…¥æ–¹æ¡ˆå¯¹æ¯”

è¿™æ˜¯é¡¹ç›®çš„**æ ¸å¿ƒæŠ€æœ¯éš¾ç‚¹**ã€‚æˆ‘ä»¬éœ€è¦åœ¨ Avalonia åº”ç”¨ä¸­åµŒå…¥åŠŸèƒ½å®Œæ•´çš„æµè§ˆå™¨å†…æ ¸æ¥è®¿é—® https://autoglm.zhipuai.cn/ ç­‰ç½‘ç«™ã€‚

### 2.1 æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ Xilium.CefGlueï¼ˆæ¨èï¼‰

**CefGlue** æ˜¯åŸºäº Chromium Embedded Framework (CEF) çš„ .NET ç»‘å®šï¼Œæ˜¯æœ€æˆç†Ÿçš„æ–¹æ¡ˆã€‚

**ä¼˜ç‚¹**ï¼š
- âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒç°ä»£ Web æŠ€æœ¯ï¼ˆHTML5ã€CSS3ã€JavaScriptï¼‰
- âœ… **è·¨å¹³å°**ï¼šWindowsã€Linuxã€macOS å‡æ”¯æŒ
- âœ… **JavaScript äº’æ“ä½œ**ï¼šå¯ä»¥æ‰§è¡Œ JS ä»£ç å¹¶è·å–è¿”å›ç»“æœ [19â€ ]
- âœ… **ç¤¾åŒºéªŒè¯**ï¼šæœ‰æˆåŠŸæ¡ˆä¾‹ï¼Œå¦‚å¼€æºçš„ ChatGPT å®¢æˆ·ç«¯ [25â€ ]

**ç¼ºç‚¹**ï¼š
- âš ï¸ **åŒ…ä½“è¾ƒå¤§**ï¼šå®‰è£…åŒ…çº¦ 70MBï¼ˆä½†ä¸€æ¬¡æ€§ä¸‹è½½ï¼‰
- âš ï¸ **ç‰ˆæœ¬å…¼å®¹**ï¼šéœ€è¦åŒ¹é… Avalonia ç‰ˆæœ¬ï¼ˆå¯èƒ½éœ€è¦é™çº§åˆ° Avalonia 11.0ï¼‰[11â€ ]

**å®ç°è¦ç‚¹**ï¼š
```csharp
// åœ¨ Avalonia UserControl ä¸­åµŒå…¥ CefGlue
public partial class CefBrowserView : UserControl
{
    private ChromiumWebBrowser _browser;
    
    public CefBrowserView()
    {
        InitializeComponent();
        InitializeBrowser();
    }
    
    private void InitializeBrowser()
    {
        // é…ç½® Cef è®¾ç½®
        var settings = new CefSettings();
        settings.WindowlessRenderingEnabled = true;
        
        // åˆ›å»ºæµè§ˆå™¨å®ä¾‹
        _browser = new ChromiumWebBrowser("https://autoglm.zhipuai.cn/");
        _browser.Dock = Dock.Fill;
        this.Content = _browser;
    }
}
```

### 2.2 æ–¹æ¡ˆäºŒï¼šWebView2ï¼ˆWindows ä¸“ç”¨ï¼‰

å¦‚æœç›®æ ‡å¹³å°ä¸»è¦æ˜¯ Windowsï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ **WebView2**ï¼ˆåŸºäº Edge Chromiumï¼‰ã€‚

**ä¼˜ç‚¹**ï¼š
- âœ… **ç³»ç»Ÿé›†æˆ**ï¼šWindows 10/11 åŸç”Ÿæ”¯æŒ
- âœ… **ä½“ç§¯å°**ï¼šåˆ©ç”¨ç³»ç»Ÿ WebView ç»„ä»¶
- âœ… **æ€§èƒ½ä¼˜å¼‚**ï¼šä¸ Edge åŒç­‰çº§åˆ«

**ç¼ºç‚¹**ï¼š
- âŒ **ä»… Windows**ï¼šmacOS/Linux éœ€è¦é¢å¤–æ–¹æ¡ˆ
- âŒ **éƒ¨ç½²å¤æ‚**ï¼šéœ€è¦æ£€æŸ¥ WebView2 è¿è¡Œæ—¶å®‰è£…çŠ¶æ€ [53â€ ]

### 2.3 æ–¹æ¡ˆä¸‰ï¼šæ··åˆæ¶æ„ï¼ˆé•¿è¿œè€ƒè™‘ï¼‰

**æ€è·¯**ï¼šä¸»ç•Œé¢ä½¿ç”¨ Avaloniaï¼Œæµè§ˆå™¨éƒ¨åˆ†ä½¿ç”¨ **Blazor WebAssembly** ç»„ä»¶ã€‚

**ä¼˜ç‚¹**ï¼š
- âœ… **çœŸæ­£çš„ Web æŠ€æœ¯**ï¼šæ—  CEF ä¾èµ–
- âœ… **æ›´æ–°çµæ´»**ï¼šWeb éƒ¨åˆ†å¯ç‹¬ç«‹æ›´æ–°

**ç¼ºç‚¹**ï¼š
- âš ï¸ **åŠŸèƒ½å—é™**ï¼šæ— æ³•è®¿é—®ç³»ç»Ÿçº§ API
- âš ï¸ **éœ€è¦åç«¯**ï¼šä¸ Avalonia é€šä¿¡éœ€è¦æ¡¥æ¥

**å»ºè®®**ï¼šMVP é˜¶æ®µä½¿ç”¨ CefGlueï¼Œæˆç†Ÿåå¯è€ƒè™‘ WebAssembly æ–¹æ¡ˆã€‚

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ¶æ„è®¾è®¡

### 3.1 å¯¼èˆªç³»ç»Ÿè®¾è®¡

**éœ€æ±‚**ï¼šæ”¯æŒå¤šä¸ª AI Agent é¡µé¢åˆ‡æ¢ï¼Œç±»ä¼¼æµè§ˆå™¨ Tabï¼Œä½†éšè—æµè§ˆå™¨ UIã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

```csharp
// å¯¼èˆªæœåŠ¡æ¥å£
public interface INavigationService
{
    Task NavigateToAgentAsync(string agentId, string? initialPrompt = null);
    Task SwitchAgentAsync(string agentId);
    Task<bool> CanGoBack();
    Task<bool> CanGoForward();
}

// å®ç°
public class NavigationService : INavigationService
{
    private readonly Dictionary<string, AgentTab> _tabs = new();
    private AgentTab? _currentTab;
    
    public async Task NavigateToAgentAsync(string agentId, string? initialPrompt = null)
    {
        if (_tabs.ContainsKey(agentId))
        {
            await SwitchAgentAsync(agentId);
            return;
        }
        
        // åˆ›å»ºæ–°çš„ Agent å®ä¾‹
        var agent = await CreateAgentAsync(agentId, initialPrompt);
        _tabs[agentId] = agent;
        _currentTab = agent;
        
        // é€šçŸ¥ UI åˆ‡æ¢
        OnCurrentTabChanged?.Invoke(agent);
    }
}
```

**å…³é”®ç‚¹**ï¼š
- **æ‡’åŠ è½½**ï¼šåªæœ‰åˆ‡æ¢åˆ°æŸä¸ª Tab æ—¶æ‰åˆ›å»º WebView
- **çŠ¶æ€ç®¡ç†**ï¼šæ¯ä¸ª Agent ç»´æŠ¤ç‹¬ç«‹çš„å¯¹è¯çŠ¶æ€
- **å†å²è®°å½•**ï¼šæ”¯æŒå‰è¿›/åé€€ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

### 3.2 åœ°å€æ ä¸è¾“å…¥ç³»ç»Ÿ

**è®¾è®¡æ€è·¯**ï¼šå°†æµè§ˆå™¨çš„åœ°å€æ "AI åŒ–"ï¼Œç”¨æˆ·è¾“å…¥çš„æ˜¯å¯¹ AI çš„æŒ‡ä»¤è€Œé URLã€‚

**XAML ç¤ºä¾‹**ï¼š
```xml
<Grid>
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <DockPanel Height="48" Background="{DynamicResource SystemChromeLowColor}">
        <!-- åœ°å€/è¾“å…¥æ¡† -->
        <Border Background="{DynamicResource SystemChromeMediumColor}" 
                CornerRadius="4" 
                Margin="8,0">
            <Grid>
                <TextBox x:Name="InputBox" 
                         FontSize="14"
                         Padding="12,0"
                         VerticalAlignment="Center">
                    <TextBox.KeyBindings>
                        <KeyBinding Gesture="Enter" Command="{Binding SendCommand}"/>
                    </TextBox.KeyBindings>
                </TextBox>
                <Button Content="å‘é€" 
                        Command="{Binding SendCommand}"
                        Padding="16,0"
                        Margin="4,0,8,0"/>
            </Grid>
        </Border>
        
        <!-- Agent é€‰æ‹©å™¨ -->
        <ComboBox ItemsSource="{Binding Agents}"
                  SelectedItem="{Binding CurrentAgent}"
                  Width="150"
                  HorizontalAlignment="Right"
                  Margin="0,0,8,0"/>
    </DockPanel>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <ContentControl Content="{Binding CurrentWebView}"/>
</Grid>
```

**æŠ€æœ¯è¦ç‚¹**ï¼š
- **çƒ­é”®æ”¯æŒ**ï¼šCtrl+Enter å¿«é€Ÿå‘é€
- **å†å²è®°å½•**ï¼šè®°å½•è¾“å…¥å†å²ï¼Œæ”¯æŒä¸Šä¸‹ç®­å¤´å›æº¯
- **è‡ªåŠ¨è¡¥å…¨**ï¼šå¯é€‰çš„æ™ºèƒ½æç¤ºåŠŸèƒ½

### 3.3 åˆ·æ–°ä¸æ§åˆ¶åŠŸèƒ½

**éšè—æµè§ˆå™¨ UI çš„å…³é”®**ï¼šä¸æ˜¾ç¤ºæµè§ˆå™¨å·¥å…·æ ï¼Œé€šè¿‡è‡ªå®šä¹‰æŒ‰é’®æ§åˆ¶ã€‚

**åŠŸèƒ½æ˜ å°„**ï¼š
- **åˆ·æ–°**ï¼š`_browser.Reload()`
- **åœæ­¢**ï¼š`_browser.Stop()`
- **å‰è¿›/åé€€**ï¼š`_browser.GoForward()` / `_browser.GoBack()`
- **æ»šåŠ¨**ï¼šç›‘å¬é¼ æ ‡æ»šè½®äº‹ä»¶ï¼Œè°ƒç”¨ Cef API

**å®ç°ç¤ºä¾‹**ï¼š
```csharp
public class BrowserController
{
    private readonly ChromiumWebBrowser _browser;
    
    public async Task RefreshAsync()
    {
        await _browser.Reload();
    }
    
    public async Task StopAsync()
    {
        await _browser.Stop();
    }
    
    // ç›‘å¬é¡µé¢åŠ è½½çŠ¶æ€
    private void OnLoadingStateChanged(object? sender, LoadingStateChangedEventArgs e)
    {
        IsLoading = e.IsLoading;
        OnPropertyChanged(nameof(IsLoading));
    }
}
```

### 3.4 é¡µé¢å†…å®¹è§£æä¸æ“ä½œå°è£…

è¿™æ˜¯é¡¹ç›®çš„**æ ¸å¿ƒä»·å€¼ç‚¹**â€”â€”æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè¯»å–å’Œæ“ä½œ AI é¡µé¢çš„å†…å®¹ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

#### æ–¹æ¡ˆ Aï¼šJavaScript æ³¨å…¥ï¼ˆæ¨èï¼‰

é€šè¿‡ Cef çš„ JS äº’æ“ä½œèƒ½åŠ›ï¼Œåœ¨é¡µé¢ä¸­æ³¨å…¥æˆ‘ä»¬çš„è„šæœ¬ã€‚

```csharp
public class PageInteractionService
{
    private readonly ChromiumWebBrowser _browser;
    
    // æ³¨å…¥è„šæœ¬ï¼Œå°è£…é¡µé¢æ“ä½œ API
    public async Task InjectScriptsAsync()
    {
        var script = @"
            (function() {
                // åˆ›å»ºå…¨å±€å¯¹è±¡
                window.__AI_TOOL__ = {
                    // è·å–å¯¹è¯å†å²
                    getHistory: function() {
                        return document.querySelectorAll('.message-bubble');
                    },
                    
                    // è¾“å…¥æ–‡æœ¬
                    inputText: function(text) {
                        const input = document.querySelector('textarea');
                        input.value = text;
                        input.dispatchEvent(new Event('input', { bubbles: true }));
                    },
                    
                    // ç‚¹å‡»å‘é€
                    send: function() {
                        const button = document.querySelector('button.send');
                        button.click();
                    }
                };
            })();
        ";
        
        await _browser.ExecuteJavaScriptAsync(script);
    }
    
    // è°ƒç”¨é¡µé¢ä¸­çš„å‡½æ•°
    public async Task<string> GetPageContentAsync()
    {
        var result = await _browser.EvaluateJavaScriptAsync("__AI_TOOL__.getHistory()");
        return result?.ToString() ?? string.Empty;
    }
}
```

#### æ–¹æ¡ˆ Bï¼šDOM äº‹ä»¶ç›‘å¬

é€šè¿‡ç›‘å¬é¡µé¢ DOM å˜åŒ–ï¼Œå®æ—¶æ›´æ–°å¯¹è¯çŠ¶æ€ã€‚

```csharp
// ä½¿ç”¨ MutationObserver ç›‘å¬ DOM å˜åŒ–
var script = @"
    const observer = new MutationObserver((mutations) => {
        // é€šçŸ¥ C# å±‚é¡µé¢å†…å®¹å·²å˜åŒ–
        window.chrome.webview.postMessage({
            type: 'content-changed',
            content: document.body.innerText
        });
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
";
```

### 3.5 "å¿ƒæ™ºæ¨¡å¼"ï¼ˆè§’è‰²ç³»ç»Ÿï¼‰è®¾è®¡

**éœ€æ±‚**ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸åŒçš„è§’è‰²/å¿ƒæ™ºæ¨¡å¼ï¼Œå½±å“ AI çš„è¡Œä¸ºå’Œå›å¤é£æ ¼ã€‚

**æ•°æ®æ¨¡å‹**ï¼š
```csharp
public class Mindset
{
    public string Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; }
    public string SystemPrompt { get; set; }  // å‘é€ç»™ AI çš„ç³»ç»Ÿæç¤ºè¯
    public Color AccentColor { get; set; }
}

public class MindsetService
{
    private readonly List<Mindset> _mindsets = new()
    {
        new Mindset { 
            Id = "assistant", 
            Name = "æ™ºèƒ½åŠ©æ‰‹", 
            SystemPrompt = "ä½ æ˜¯ä¸€ä¸ª helpful çš„ AI åŠ©æ‰‹" 
        },
        new Mindset { 
            Id = "programmer", 
            Name = "ç¼–ç¨‹ä¸“å®¶", 
            SystemPrompt = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¨‹åºå‘˜ï¼Œæ“…é•¿ä»£ç  review" 
        },
        new Mindset { 
            Id = "writer", 
            Name = "å†™ä½œé¡¾é—®", 
            SystemPrompt = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä½œå®¶ï¼Œæ“…é•¿æ¶¦è‰²æ–‡ç« " 
        }
    };
    
    public async Task SwitchMindsetAsync(string mindsetId)
    {
        var mindset = _mindsets.FirstOrDefault(m => m.Id == mindsetId);
        if (mindset == null) return;
        
        // å°†ç³»ç»Ÿæç¤ºè¯å‘é€ç»™å½“å‰ AI é¡µé¢
        await _pageInteractionService.InputTextAsync($"ç³»ç»Ÿï¼š{mindset.SystemPrompt}");
    }
}
```

**UI å®ç°**ï¼š
```xml
<ItemsControl ItemsSource="{Binding Mindsets}">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <Border Background="{Binding AccentColor, Converter={StaticResource ColorToBrushConverter}}"
                    Width="120"
                    Height="40"
                    CornerRadius="4"
                    Margin="4"
                    Cursor="Hand">
                <TextBlock Text="{Binding Name}" 
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Foreground="White"/>
            </Border>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl>
```

---

## å››ã€ç°ä»£åŒ– UI è®¾è®¡æ€è·¯

### 4.1 æš—è‰²ä¸»é¢˜ä¸æ ·å¼ç³»ç»Ÿ

æ ¹æ® Avalonia å®˜æ–¹æ–‡æ¡£ [27â€ ]ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å®ç°æš—è‰²ä¸»é¢˜ã€‚

**App.axaml é…ç½®**ï¼š
```xml
<Application.Styles>
    <!-- Fluent ä¸»é¢˜ -->
    <FluentTheme>
        <!-- è‡ªå®šä¹‰æš—è‰²è°ƒè‰²æ¿ -->
        <FluentTheme.Palettes>
            <ColorPaletteResources Key="Dark">
                <AccentColor> #0078D4 </AccentColor>
                <RegionColor> #202020 </RegionColor>
                <ErrorText> #F44336 </ErrorText>
            </ColorPaletteResources>
        </FluentTheme.Palettes>
    </FluentTheme>
</Application.Styles>
```

**ä¸»é¢˜åˆ‡æ¢å®ç°**ï¼š
```csharp
public class ThemeService
{
    public async Task SwitchThemeAsync(bool isDark)
    {
        var theme = isDark ? "Dark" : "Light";
        Application.Current.RequestedThemeVariant = theme switch
        {
            "Dark" => ThemeVariant.Dark,
            "Light" => ThemeVariant.Light,
            _ => ThemeVariant.Default
        };
    }
}
```

### 4.2 åŠ¨ç”»ä¸è¿‡æ¸¡æ•ˆæœ

ä½¿ç”¨ Avalonia çš„åŠ¨ç”»ç³»ç»Ÿï¼Œè®©ç•Œé¢åˆ‡æ¢æ›´æµç•…ã€‚

**ç¤ºä¾‹ï¼šTab åˆ‡æ¢åŠ¨ç”»**
```xml
<Grid.Transitions>
    <Transitions>
        <DoubleTransition Property="Opacity" Duration="00:00:200"/>
        <TranslateTransition Property="TranslateTransform.X" Duration="00:00:300"/>
    </Transitions>
</Grid.Transitions>
```

### 4.3 ç°ä»£åŒ–å¸ƒå±€è®¾è®¡

**å‚è€ƒ VS Code / JetBrains å·¥å…·é£æ ¼**ï¼š
- **ä¾§è¾¹æ **ï¼šæ˜¾ç¤º AI Agent åˆ—è¡¨å’Œå¯¹è¯å†å²
- **ä¸»åŒºåŸŸ**ï¼šWebView å æ®ä¸»è¦ç©ºé—´
- **åº•éƒ¨æ **ï¼šè¾“å…¥æ¡†å’ŒçŠ¶æ€ä¿¡æ¯
- **æµ®åŠ¨å·¥å…·æ **ï¼šåˆ·æ–°ã€è®¾ç½®ç­‰å¿«æ·æ“ä½œ

**XAML å¸ƒå±€ç¤ºä¾‹**ï¼š
```xml
<Grid>
    <!-- å·¦ä¾§è¾¹æ  -->
    <Grid Width="250" Background="{DynamicResource SystemChromeMediumColor}">
        <ScrollViewer>
            <ItemsControl ItemsSource="{Binding AgentHistory}">
                <!-- å†å²è®°å½•é¡¹ -->
            </ItemsControl>
        </ScrollViewer>
    </Grid>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <Grid Margin="8">
        <!-- åœ°å€æ  -->
        <Border Height="48" ...>
            <!-- åœ°å€/è¾“å…¥æ§ä»¶ -->
        </Border>
        
        <!-- WebView å®¹å™¨ -->
        <Border Background="{DynamicResource SystemChromeLowColor}"
                CornerRadius="4"
                Padding="4">
            <ContentControl Content="{Binding CurrentWebView}"/>
        </Border>
        
        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <StatusBar Height="24" 
                   VerticalAlignment="Bottom"
                   Background="{DynamicResource SystemChromeMediumColor}">
            <StatusBarItem Content="{Binding CurrentAgent.Name}"/>
            <StatusBarItem Content="{Binding ConnectionStatus}"/>
        </StatusBar>
    </Grid>
</Grid>
```

---

## äº”ã€é¡¹ç›®æ¶æ„ä¸ä»£ç ç»„ç»‡

### 5.1 MVVM æ¶æ„æ¨¡å¼

é‡‡ç”¨ç»å…¸çš„ **Model-View-ViewModel** æ¨¡å¼ï¼Œä¿æŒä»£ç å¯ç»´æŠ¤æ€§ã€‚

**é¡¹ç›®ç»“æ„**ï¼š
```
AvaloniaBrowser/
â”œâ”€â”€ App.axaml                 # åº”ç”¨ç¨‹åºå…¥å£
â”œâ”€â”€ App.xaml.cs               # åº”ç”¨ç¨‹åºé€»è¾‘
â”œâ”€â”€ Services/                 # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ NavigationService.cs  # å¯¼èˆªæœåŠ¡
â”‚   â”œâ”€â”€ BrowserController.cs  # æµè§ˆå™¨æ§åˆ¶
â”‚   â”œâ”€â”€ PageInteractionService.cs  # é¡µé¢äº¤äº’
â”‚   â”œâ”€â”€ MindsetService.cs     # å¿ƒæ™ºæ¨¡å¼ç®¡ç†
â”‚   â””â”€â”€ ThemeService.cs       # ä¸»é¢˜ç®¡ç†
â”œâ”€â”€ ViewModels/               # è§†å›¾æ¨¡å‹
â”‚   â”œâ”€â”€ MainViewModel.cs      # ä¸»ç•Œé¢ VM
â”‚   â”œâ”€â”€ AgentTabViewModel.cs  # Agent Tab VM
â”‚   â””â”€â”€ SettingsViewModel.cs  # è®¾ç½® VM
â”œâ”€â”€ Views/                    # è§†å›¾å±‚
â”‚   â”œâ”€â”€ MainWindow.axaml      # ä¸»çª—å£
â”‚   â”œâ”€â”€ AgentTabView.axaml    # Agent è§†å›¾
â”‚   â””â”€â”€ SettingsView.axaml    # è®¾ç½®è§†å›¾
â”œâ”€â”€ Controls/                 # è‡ªå®šä¹‰æ§ä»¶
â”‚   â”œâ”€â”€ CefBrowserView.cs     # CEF æµè§ˆå™¨æ§ä»¶
â”‚   â””â”€â”€ AddressBar.cs         # åœ°å€æ æ§ä»¶
â”œâ”€â”€ Models/                   # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ Agent.cs              # Agent æ•°æ®
â”‚   â”œâ”€â”€ Message.cs            # æ¶ˆæ¯æ•°æ®
â”‚   â””â”€â”€ Mindset.cs            # å¿ƒæ™ºæ¨¡å¼æ•°æ®
â”œâ”€â”€ Resources/                # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ Styles/               # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ Localization/         # æœ¬åœ°åŒ–èµ„æº
â””â”€â”€ Utils/                    # å·¥å…·ç±»
    â”œâ”€â”€ JsBridge.cs           # JS æ¡¥æ¥
    â””â”€â”€ Extensions.cs         # æ‰©å±•æ–¹æ³•
```

### 5.2 ä¾èµ–æ³¨å…¥ä¸ Service Locator

ä½¿ç”¨ **.NET åŸç”Ÿ DI** å®¹å™¨ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸã€‚

**App.xaml.cs**ï¼š
```csharp
public partial class App : Application
{
    private IServiceProvider _serviceProvider;
    
    protected override void OnStartup(StartupEventArgs e)
    {
        var services = new ServiceCollection();
        
        // æ³¨å†ŒæœåŠ¡
        services.AddSingleton<INavigationService, NavigationService>();
        services.AddSingleton<IBrowserController, BrowserController>();
        services.AddSingleton<IPageInteractionService, PageInteractionService>();
        services.AddSingleton<IMindsetService, MindsetService>();
        
        // æ³¨å†Œ ViewModels
        services.AddTransient<MainViewModel>();
        services.AddTransient<AgentTabViewModel>();
        
        _serviceProvider = services.BuildServiceProvider();
        
        // å¯åŠ¨ä¸»çª—å£
        var mainWindow = new MainWindow(_serviceProvider.GetService<MainViewModel>());
        mainWindow.Show();
    }
}
```

### 5.3 é…ç½®ç®¡ç†

ä½¿ç”¨ **appsettings.json** ç®¡ç†åº”ç”¨é…ç½®ã€‚

```json
{
  "Settings": {
    "DefaultAgent": "autoglm",
    "Theme": "Dark",
    "JsInjectionEnabled": true,
    "AutoSaveEnabled": true
  },
  "Agents": [
    {
      "Id": "autoglm",
      "Name": "æ™ºè°± AI",
      "Url": "https://autoglm.zhipuai.cn/",
      "Enabled": true
    },
    {
      "Id": "openai",
      "Name": "ChatGPT",
      "Url": "https://chat.openai.com/",
      "Enabled": false
    }
  ]
}
```

---

## å…­ã€æ•°æ®å­˜æ¡£ä¸çŸ¥è¯†åº“æ„å»º

### 6.1 å¯¹è¯å­˜æ¡£æ–¹æ¡ˆ

**éœ€æ±‚**ï¼šä¿å­˜ä¸åŒ AI çš„å¯¹è¯å†…å®¹ï¼Œæ”¯æŒå¯¼å‡ºå’Œä¸‹è½½ã€‚

**æ•°æ®æ¨¡å‹**ï¼š
```csharp
public class ConversationArchive
{
    public string Id { get; set; }
    public string AgentId { get; set; }
    public string MindsetId { get; set; }
    public DateTime StartTime { get; set; }
    public DateTime EndTime { get; set; }
    public List<Message> Messages { get; set; } = new();
    public string? Title { get; set; }
    public List<string> Tags { get; set; } = new();
}

public class Message
{
    public string Id { get; set; }
    public string Content { get; set; }
    public string Role { get; set; }  // user/assistant/system
    public DateTime Timestamp { get; set; }
    public bool IsFromTool { get; set; }  // æ˜¯å¦æ˜¯å·¥å…·æ³¨å…¥çš„å†…å®¹
}
```

**å­˜å‚¨æ–¹æ¡ˆ**ï¼š
- **æœ¬åœ°å­˜å‚¨**ï¼šä½¿ç”¨ **SQLite** + **Entity Framework Core**
- **æ–‡ä»¶å¯¼å‡º**ï¼šæ”¯æŒ Markdownã€JSONã€HTML æ ¼å¼
- **äº‘å­˜å‚¨**ï¼šå¯é€‰çš„ OneDrive/Dropbox é›†æˆ

**å®ç°ç¤ºä¾‹**ï¼š
```csharp
public class ArchiveService
{
    private readonly IDbContextFactory<AppDbContext> _contextFactory;
    
    public async Task SaveConversationAsync(string agentId, string mindsetId, List<Message> messages)
    {
        using var context = await _contextFactory.CreateDbContextAsync();
        
        var archive = new ConversationArchive
        {
            Id = Guid.NewGuid().ToString(),
            AgentId = agentId,
            MindsetId = mindsetId,
            StartTime = messages.First().Timestamp,
            EndTime = messages.Last().Timestamp,
            Messages = messages
        };
        
        context.Archives.Add(archive);
        await context.SaveChangesAsync();
    }
    
    public async Task<string> ExportToMarkdownAsync(string archiveId)
    {
        using var context = await _contextFactory.CreateDbContextAsync();
        
        var archive = await context.Archives
            .Include(a => a.Messages)
            .FirstOrDefaultAsync(a => a.Id == archiveId);
        
        if (archive == null) return string.Empty;
        
        var markdown = new StringBuilder();
        markdown.AppendLine($"# {archive.Title ?? archive.Id}");
        markdown.AppendLine($"**Agent**: {archive.AgentId}");
        markdown.AppendLine($"**Mindset**: {archive.MindsetId}");
        markdown.AppendLine($"**Time**: {archive.StartTime:yyyy-MM-dd HH:mm}");
        markdown.AppendLine();
        
        foreach (var message in archive.Messages)
        {
            var role = message.Role switch
            {
                "user" => "ğŸ‘¤ User",
                "assistant" => "ğŸ¤– Assistant",
                "system" => "âš™ï¸ System",
                _ => message.Role
            };
            
            markdown.AppendLine($"### {role}");
            markdown.AppendLine(message.Content);
            markdown.AppendLine();
        }
        
        return markdown.ToString();
    }
}
```

### 6.2 çŸ¥è¯†åº“æ„å»ºåŠŸèƒ½

**æ€è·¯**ï¼šå°†å­˜æ¡£çš„å¯¹è¯å†…å®¹è¿›è¡Œå‘é‡åŒ–å­˜å‚¨ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- **æœ¬åœ°å‘é‡æ•°æ®åº“**ï¼šä½¿ç”¨ **FAISS**ï¼ˆFacebook AI Similarity Searchï¼‰
- **åµŒå…¥æ¨¡å‹**ï¼šå¯é€‰çš„ OpenAI Embedding æˆ–æœ¬åœ°æ¨¡å‹
- **æœç´¢åŠŸèƒ½**ï¼šåŸºäºä½™å¼¦ç›¸ä¼¼åº¦çš„è¯­ä¹‰æœç´¢

**ç¤ºä¾‹ä»£ç **ï¼š
```csharp
public class KnowledgeBaseService
{
    private readonly IEmbeddingService _embeddingService;
    private readonly IVectorStore _vectorStore;
    
    public async Task IndexArchiveAsync(ConversationArchive archive)
    {
        // 1. å°†å¯¹è¯å†…å®¹åˆå¹¶ä¸ºä¸€ä¸ªæ–‡æœ¬å—
        var fullText = string.Join("\n\n", archive.Messages.Select(m => m.Content));
        
        // 2. ç”Ÿæˆå‘é‡åµŒå…¥
        var embedding = await _embeddingService.GenerateEmbeddingAsync(fullText);
        
        // 3. å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“
        await _vectorStore.AddVectorAsync(new VectorDocument
        {
            Id = archive.Id,
            Vector = embedding,
            Metadata = new Dictionary<string, object>
            {
                ["agentId"] = archive.AgentId,
                ["mindsetId"] = archive.MindsetId,
                ["startTime"] = archive.StartTime,
                ["text"] = fullText
            }
        });
    }
    
    public async Task<List<ConversationArchive>> SearchAsync(string query, int limit = 10)
    {
        var queryEmbedding = await _embeddingService.GenerateEmbeddingAsync(query);
        
        var results = await _vectorStore.SearchAsync(queryEmbedding, limit);
        
        return results.Select(r => GetArchiveFromMetadata(r.Metadata)).ToList();
    }
}
```

---

## ä¸ƒã€æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 7.1 CEF ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

**æŒ‘æˆ˜**ï¼šCefGlue å¯¹ Avalonia ç‰ˆæœ¬æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œå¯èƒ½å‡ºç°ç‰ˆæœ¬ä¸åŒ¹é… [11â€ ]ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ç‰ˆæœ¬é”å®š**ï¼šåœ¨ `.csproj` ä¸­æ˜ç¡®æŒ‡å®š Avalonia å’Œ CefGlue çš„ç‰ˆæœ¬
   ```xml
   <PropertyGroup>
     <AvaloniaVersion>11.0.0</AvaloniaVersion>
     <CefGlueVersion>1.0.0</CefGlueVersion>
   </PropertyGroup>
   
   <ItemGroup>
     <PackageReference Include="Avalonia" Version="$(AvaloniaVersion)" />
     <PackageReference Include="Xilium.CefGlue" Version="$(CefGlueVersion)" />
   </ItemGroup>
   ```

2. **å¤šå¹³å°é…ç½®**ï¼šä¸ºä¸åŒå¹³å°é…ç½®ç‹¬ç«‹çš„ CEF è®¾ç½®
   ```csharp
   #if WINDOWS
   var settings = new CefSettings { WindowlessRenderingEnabled = true };
   #elif LINUX
   var settings = new CefSettings { 
       WindowlessRenderingEnabled = true,
       NoSandbox = true  // Linux å¯èƒ½éœ€è¦ç¦ç”¨æ²™ç®±
   };
   #endif
   ```

### 7.2 JavaScript äº’æ“ä½œçš„å¤æ‚æ€§

**æŒ‘æˆ˜**ï¼šCef çš„ JS API è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦å¤„ç†å›è°ƒåœ°ç‹±ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ä½¿ç”¨ TaskCompletionSource** å°†å›è°ƒè½¬ä¸º async/await
   ```csharp
   public async Task<string> ExecuteJsAsync(string script)
   {
       var tcs = new TaskCompletionSource<string>();
       
       var handler = new JavascriptMethodHandler((args) =>
       {
           tcs.TrySetResult(args.String);
       });
       
       await _browser.ExecuteJavaScriptWithResultAsync(script, handler);
       return await tcs.Task;
   }
   ```

2. **ç»Ÿä¸€ JS Bridge**ï¼šåˆ›å»ºä¸€ä¸ªå…¨å±€ JS å¯¹è±¡ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰å›è°ƒ
   ```javascript
   //æ³¨å…¥åˆ°é¡µé¢
   window.__CSharpBridge__ = {
       callbacks: {},
       
       register: function(id, callback) {
           this.callbacks[id] = callback;
       },
       
       invoke: function(id, ...args) {
           if (this.callbacks[id]) {
               this.callbacks[id](...args);
               delete this.callbacks[id];
           }
       }
   };
   ```

### 7.3 æ€§èƒ½ä¼˜åŒ–ä¸å†…å­˜ç®¡ç†

**æŒ‘æˆ˜**ï¼šå¤šä¸ª WebView å®ä¾‹å¯èƒ½å ç”¨å¤§é‡å†…å­˜ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **è™šæ‹ŸåŒ–**ï¼šåªä¿ç•™å½“å‰å¯è§çš„å‡ ä¸ª Tabï¼Œå…¶ä»– Tab é‡Šæ”¾èµ„æº
   ```csharp
   public class TabManager
   {
       private readonly Dictionary<string, WeakReference<CefBrowserView>> _tabs = new();
       private const int MaxActiveTabs = 5;
       
       public void ActivateTab(string agentId)
       {
           if (_tabs.Count >= MaxActiveTabs)
           {
               // é‡Šæ”¾æœ€ä¹…æœªç”¨çš„ Tab
               var oldestTab = _tabs.OrderBy(t => t.Value.Target?.LastAccessTime).First();
               oldestTab.Value.Target?.Dispose();
               _tabs.Remove(oldestTab.Key);
           }
           
           // åˆ›å»ºæˆ–æ¿€æ´»ç›®æ ‡ Tab
           if (!_tabs.TryGetValue(agentId, out var tabRef) || tabRef.Target == null)
           {
               var newTab = new CefBrowserView();
               _tabs[agentId] = new WeakReference<CefBrowserView>(newTab);
           }
       }
   }
   ```

2. **å®šæœŸåƒåœ¾å›æ”¶**ï¼šåœ¨åº”ç”¨ç©ºé—²æ—¶è§¦å‘ GC
   ```csharp
   public class PerformanceService
   {
       private readonly Timer _gcTimer;
       
       public PerformanceService()
       {
           _gcTimer = new Timer(_ =>
           {
               GC.Collect();
               GC.WaitForPendingFinalizers();
           }, null, TimeSpan.FromMinutes(5), TimeSpan.FromMinutes(5));
       }
   }
   ```

### 7.4 ç½‘ç»œå¼‚å¸¸ä¸é‡è¿æœºåˆ¶

**æŒ‘æˆ˜**ï¼šAI æœåŠ¡å¯èƒ½ä¸ç¨³å®šï¼Œéœ€è¦å¤„ç†ç½‘ç»œé”™è¯¯ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **é‡è¯•ç­–ç•¥**ï¼šä½¿ç”¨æŒ‡æ•°é€€é¿ç®—æ³•
   ```csharp
   public async Task<T> ExecuteWithRetryAsync<T>(Func<Task<T>> action, int maxRetries = 3)
   {
       for (int i = 0; i < maxRetries; i++)
       {
           try
           {
               return await action();
           }
           catch (Exception ex) when (i < maxRetries - 1)
           {
               var delay = TimeSpan.FromSeconds(Math.Pow(2, i));
               await Task.Delay(delay);
           }
       }
       
       throw new InvalidOperationException($"æ“ä½œå¤±è´¥ï¼Œå·²é‡è¯• {maxRetries} æ¬¡");
   }
   ```

2. **ç¦»çº¿ç¼“å­˜**ï¼šç¼“å­˜æœ€è¿‘çš„å¯¹è¯å†…å®¹ï¼Œç¦»çº¿æ—¶å¯ä»¥æŸ¥çœ‹
   ```csharp
   public class OfflineCacheService
   {
       public async Task<List<Message>> GetCachedMessagesAsync(string agentId)
       {
           var cacheFile = Path.Combine(_cacheDir, $"{agentId}.json");
           if (!File.Exists(cacheFile)) return new List<Message>();
           
           var json = await File.ReadAllTextAsync(cacheFile);
           return JsonSerializer.Deserialize<List<Message>>(json) ?? new List<Message>();
       }
   }
   ```

---

## å…«ã€æ‰©å±•æ€§ä¸ç»´æŠ¤æ€§è€ƒè™‘

### 8.1 æ’ä»¶åŒ–æ¶æ„è®¾è®¡

**ç›®æ ‡**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ AI Agentï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
1. **æ’ä»¶æ¥å£å®šä¹‰**
   ```csharp
   public interface IAgentProvider
   {
       string Id { get; }
       string Name { get; }
       string Description { get; }
       Task InitializeAsync();
       Task<BrowserView> CreateBrowserAsync();
       Task<bool> IsSupportedAsync();
   }
   ```

2. **æ’ä»¶åŠ è½½å™¨**
   ```csharp
   public class PluginLoader
   {
       public async Task<List<IAgentProvider>> LoadPluginsAsync(string pluginDir)
       {
           var plugins = new List<IAgentProvider>();
           
           foreach (var dll in Directory.GetFiles(pluginDir, "*.dll"))
           {
               var assembly = Assembly.LoadFrom(dll);
               var types = assembly.GetTypes().Where(t => typeof(IAgentProvider).IsAssignableFrom(t));
               
               foreach (var type in types)
               {
                   if (Activator.CreateInstance(type) is IAgentProvider provider)
                   {
                       await provider.InitializeAsync();
                       plugins.Add(provider);
                   }
               }
           }
           
           return plugins;
       }
   }
   ```

3. **é…ç½®æ–‡ä»¶é©±åŠ¨**
   ```json
   {
     "Plugins": [
       {
         "Id": "zhipuai",
         "Name": "æ™ºè°± AI",
         "Assembly": "ZhipuAgent.dll",
         "Config": {
           "Url": "https://autoglm.zhipuai.cn/",
           "Version": "1.0.0"
         }
       }
     ]
   }
   ```

### 8.2 è‡ªåŠ¨æ›´æ–°æœºåˆ¶

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼šä½¿ç”¨ **.NET updater** æˆ–è‡ªå»ºæ›´æ–°æœåŠ¡å™¨ã€‚

```csharp
public class UpdateService
{
    public async Task<bool> CheckUpdateAsync()
    {
        var currentVersion = GetCurrentVersion();
        var latestVersion = await GetLatestVersionFromServer();
        
        return latestVersion > currentVersion;
    }
    
    public async Task DownloadUpdateAsync(string downloadUrl)
    {
        using var httpClient = new HttpClient();
        using var response = await httpClient.GetAsync(downloadUrl);
        response.EnsureSuccessStatusCode();
        
        var setupFile = Path.Combine(TempDir, "update.setup");
        await File.WriteAllBytesAsync(setupFile, await response.Content.ReadAsByteArrayAsync());
        
        // å¯åŠ¨å®‰è£…ç¨‹åº
        Process.Start(new ProcessStartInfo
        {
            FileName = setupFile,
            UseShellExecute = true
        });
    }
}
```

### 8.3 æ—¥å¿—ä¸è¯Šæ–­ç³»ç»Ÿ

**é‡è¦æ€§**ï¼šä¾¿äºæ’æŸ¥é—®é¢˜å’Œç”¨æˆ·åé¦ˆã€‚

```csharp
public class LoggingService
{
    private readonly ILogger _logger;
    
    public LoggingService()
    {
        _logger = LoggerFactory.Create(builder =>
        {
            builder.AddFile("logs/log-{Date}.txt")
                   .SetMinimumLevel(LogLevel.Information);
        }).CreateLogger<AvaloniaBrowser.App>();
    }
    
    public void LogError(Exception ex, string context = "")
    {
        _logger.LogError(ex, $"{context}: {ex.Message}");
        
        // å¯é€‰ï¼šä¸Šä¼ åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
    }
}
```

### 8.4 å›½é™…åŒ–ä¸æœ¬åœ°åŒ–

**æ”¯æŒå¤šè¯­è¨€**ï¼šä½¿ç”¨ Avalonia çš„æœ¬åœ°åŒ–ç³»ç»Ÿã€‚

**App.axaml**ï¼š
```xml
<Application.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="Localization/Strings.zh.xaml"/>
            <ResourceDictionary Source="Localization/Strings.en.xaml"/>
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</Application.Resources>
```

**å®ç°è¯­è¨€åˆ‡æ¢**ï¼š
```csharp
public class LocalizationService
{
    public async Task SwitchLanguageAsync(string cultureCode)
    {
        var culture = new CultureInfo(cultureCode);
        Thread.CurrentThread.CurrentCulture = culture;
        Thread.CurrentThread.CurrentUICulture = culture;
        
        // é‡æ–°åŠ è½½èµ„æº
        Application.Current.Resources.MergedDictionaries.Clear();
        var resourceDict = new ResourceDictionary();
        resourceDict.Source = new Uri($"Localization/Strings.{cultureCode}.xaml");
        Application.Current.Resources.MergedDictionaries.Add(resourceDict);
    }
}
```

---

## ä¹ã€å¼€å‘è·¯çº¿å›¾ä¸é‡Œç¨‹ç¢‘

### é˜¶æ®µä¸€ï¼šMVP åŸå‹ï¼ˆ4-6 å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®ç°æ ¸å¿ƒçš„æµè§ˆå™¨åµŒå…¥å’ŒåŸºç¡€äº¤äº’ã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ­å»º Avalonia é¡¹ç›®åŸºç¡€æ¶æ„
- [ ] é›†æˆ CefGlueï¼Œå®ç°åŸºç¡€çš„ WebView æ˜¾ç¤º
- [ ] å®ç°ç®€å•çš„å¯¼èˆªç³»ç»Ÿï¼ˆæ‰“å¼€/å…³é—­/åˆ‡æ¢ï¼‰
- [ ] åˆ›å»ºåŸºç¡€çš„ç°ä»£åŒ– UIï¼ˆæš—è‰²ä¸»é¢˜ï¼‰
- [ ] å®ç°åœ°å€æ å’Œè¾“å…¥æ¡†
- [ ] æµ‹è¯•æ™ºè°± AI çš„é¡µé¢åŠ è½½å’Œäº¤äº’

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ6-8 å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®Œæˆ AI äº¤äº’å’Œå¿ƒæ™ºæ¨¡å¼åŠŸèƒ½ã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° JavaScript æ³¨å…¥å’Œé¡µé¢äº¤äº’
- [ ] å¼€å‘å¿ƒæ™ºæ¨¡å¼ç³»ç»Ÿ
- [ ] å®ç°å¯¹è¯å­˜æ¡£åŠŸèƒ½
- [ ] æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼ˆMarkdown/HTMLï¼‰
- [ ] ä¼˜åŒ– UI å’Œç”¨æˆ·ä½“éªŒ

### é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½ï¼ˆ4-6 å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®ç°çŸ¥è¯†åº“å’Œæ‰©å±•åŠŸèƒ½ã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ„å»ºå‘é‡æœç´¢å’ŒçŸ¥è¯†åº“
- [ ] å®ç°æ’ä»¶åŒ–æ¶æ„
- [ ] æ·»åŠ å¤šè¯­è¨€æ”¯æŒ
- [ ] å®ç°è‡ªåŠ¨æ›´æ–°æœºåˆ¶
- [ ] å®Œå–„æ–‡æ¡£å’Œç”¨æˆ·æŒ‡å—

### é˜¶æ®µå››ï¼šä¼˜åŒ–ä¸å‘å¸ƒï¼ˆ2-4 å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ€§èƒ½ä¼˜åŒ–å’Œæ­£å¼å‘å¸ƒã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] ä¿®å¤å…³é”® Bug
- [ ] å‡†å¤‡å‘å¸ƒåŒ…ï¼ˆå®‰è£…ç¨‹åº/ä¾¿æºç‰ˆï¼‰
- [ ] ç¼–å†™ç”¨æˆ·æ‰‹å†Œå’Œ API æ–‡æ¡£
- [ ] å‘å¸ƒåˆ° GitHub å’Œå…¶ä»–å¹³å°

---

## åã€å¼€æºä¸ç¤¾åŒºå»ºè®¾

### 10.1 é€‰æ‹©å¼€æºåè®®

**æ¨è**ï¼š**MIT License** æˆ– **Apache 2.0**

- **MIT**ï¼šå®½æ¾ï¼Œå…è®¸å•†ä¸šä½¿ç”¨ï¼Œé€‚åˆå­¦ä¹ /ç ”ç©¶é¡¹ç›®
- **Apache 2.0**ï¼šæ›´ä¸¥æ ¼çš„ä¸“åˆ©ä¿æŠ¤ï¼Œé€‚åˆä¼ä¸šä½¿ç”¨

### 10.2 GitHub ä»“åº“ç»“æ„

```
AvaloniaBrowser/
â”œâ”€â”€ .github/                  # GitHub é…ç½®
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/       # Issue æ¨¡æ¿
â”‚   â””â”€â”€ workflows/            # CI/CD é…ç½®
â”œâ”€â”€ docs/                     # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ 20260119/            # æœ¬è®¨è®ºæ–‡æ¡£
â”‚   â”œâ”€â”€ api/                  # API æ–‡æ¡£
â”‚   â””â”€â”€ user-guide/           # ç”¨æˆ·æŒ‡å—
â”œâ”€â”€ src/                      # æºä»£ç 
â”œâ”€â”€ tests/                    # å•å…ƒæµ‹è¯•
â”œâ”€â”€ artifacts/                # æ„å»ºäº§ç‰©
â”œâ”€â”€ README.md                 # é¡¹ç›®ä»‹ç»
â”œâ”€â”€ CHANGELOG.md              # å˜æ›´æ—¥å¿—
â””â”€â”€ LICENSE                   # å¼€æºåè®®
```

### 10.3 ç¤¾åŒºäº¤æµ

- **Discord/Slack**ï¼šå»ºç«‹å¼€å‘è€…äº¤æµç¾¤
- **è®¨è®ºåŒº**ï¼šGitHub Discussions ç”¨äºåŠŸèƒ½è®¨è®º
- **ç¤ºä¾‹é¡¹ç›®**ï¼šåˆ›å»ºç¤ºä¾‹ä»“åº“å±•ç¤ºç”¨æ³•

---

## æ€»ç»“ä¸ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¿™ä¸ª Avalonia ä¸“ç”¨æµè§ˆå™¨é¡¹ç›®å…·æœ‰å¾ˆå¥½çš„æŠ€æœ¯å¯è¡Œæ€§å’Œåˆ›æ–°ä»·å€¼ã€‚é€šè¿‡ Avalonia çš„è·¨å¹³å°èƒ½åŠ›ã€CefGlue çš„æµè§ˆå™¨é›†æˆã€ä»¥åŠç°ä»£åŒ–çš„ MVVM æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”ç”¨æˆ·ä½“éªŒä¼˜ç§€çš„ AI å·¥ä½œæµæ•´åˆå¹³å°ã€‚

**å…³é”®æˆåŠŸå› ç´ **ï¼š
1. **æŠ€æœ¯é€‰å‹æ­£ç¡®**ï¼šAvalonia + CefGlue æ˜¯å½“å‰æœ€ä¼˜è§£
2. **æ¶æ„æ¸…æ™°**ï¼šMVVM + ä¾èµ–æ³¨å…¥ä¿è¯å¯ç»´æŠ¤æ€§
3. **ç”¨æˆ·å‹å¥½**ï¼šéšè—æµè§ˆå™¨ UIï¼Œæä¾›å·¥å…·é£æ ¼ä½“éªŒ
4. **å¯æ‰©å±•æ€§**ï¼šæ’ä»¶åŒ–æ¶æ„æ”¯æŒæœªæ¥æ‰©å±•

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®**ï¼š
1. ç«‹å³å¼€å§‹é˜¶æ®µä¸€çš„ MVP å¼€å‘
2. åœ¨ GitHub ä¸Šåˆ›å»ºä»“åº“ï¼Œåˆå§‹åŒ–é¡¹ç›®ç»“æ„
3. å…ˆå®ç°åŸºç¡€çš„ WebView æ˜¾ç¤ºï¼ŒéªŒè¯æŠ€æœ¯å¯è¡Œæ€§
4. é€æ­¥æ·»åŠ åŠŸèƒ½ï¼Œè¿­ä»£ä¼˜åŒ–

å¸Œæœ›è¿™ä»½æŠ€æœ¯æ–¹æ¡ˆå’ŒåŠŸèƒ½è®¾è®¡è®¨è®ºèƒ½ä¸ºé¡¹ç›®æä¾›æ¸…æ™°çš„æŒ‡å¯¼ã€‚éšç€å¼€å‘çš„æ¨è¿›ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´å’Œä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆã€‚ç¥é¡¹ç›®é¡ºåˆ©æ¨è¿›ï¼

---
