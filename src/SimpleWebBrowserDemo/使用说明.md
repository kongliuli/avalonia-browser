# 极简 Web Browser Demo - 使用说明

## 快速开始

### 1. 运行应用

在项目目录下执行以下命令：

```bash
cd src/SimpleWebBrowserDemo
dotnet run
```

应用将自动启动并显示主窗口。

### 2. 基本使用

#### 浏览网页

1. 在地址栏输入网址（例如：`bing.com` 或 `https://www.google.com`）
2. 按回车键或点击"前往"按钮
3. 页面内容将自动加载并显示在主区域

#### 搜索功能

1. 在地址栏输入搜索关键词（例如：`Avalonia UI`）
2. 按回车键
3. 系统将自动跳转到 Bing 搜索结果页面

#### 导航控制

- **后退按钮**：返回到上一个浏览的页面
- **前进按钮**：前进到下一个页面
- **刷新按钮**：重新加载当前页面
- **主页按钮**：快速返回 Bing 首页

## 功能说明

### 智能地址栏

地址栏具有智能识别功能：

- **完整 URL**：如果输入 `https://www.example.com`，直接访问该网址
- **域名**：如果输入 `example.com`，自动添加 `https://` 前缀
- **搜索关键词**：如果输入普通文本（如 `搜索内容`），自动跳转到 Bing 搜索

### 页面加载

- **加载状态**：页面加载时显示进度条和"正在加载页面..."提示
- **错误处理**：如果加载失败，显示友好的错误信息
- **内容显示**：HTML 内容经过格式化后以纯文本形式显示

### 页面标题

- 自动提取并显示网页标题
- 标题显示在窗口标题栏

## 技术细节

### 网页获取方式

当前版本使用 `HttpClient` 获取网页内容：

```csharp
var response = await _httpClient.GetAsync(uri);
var content = await response.Content.ReadAsStringAsync();
```

**特点**：
- 异步加载，不阻塞 UI
- 30 秒超时设置
- 完整的错误处理

### HTML 格式化

获取的 HTML 内容经过简化处理：

```csharp
var plainText = html
    .Replace("<br>", "\n")
    .Replace("<br/>", "\n")
    .Replace("<p>", "\n\n")
    .Replace("</p>", "\n")
    .Replace("&nbsp;", " ")
    .Replace("&lt;", "<")
    .Replace("&gt;", ">")
    .Replace("&amp;", "&");
```

**目的**：将 HTML 转换为可读的纯文本格式

### MVVM 架构

项目采用标准的 MVVM 模式：

- **Model**: `BrowserState` - 数据模型
- **View**: `MainWindow.axaml` - UI 界面
- **ViewModel**: `MainViewModel` - 业务逻辑
- **Service**: `NavigationService`, `WebPageService` - 服务层

## 常见问题

### Q1: 为什么页面显示的是纯文本而不是渲染后的网页？

**A**: 当前版本是极简演示，使用 HttpClient 获取 HTML 内容并简化显示。这是为了验证 Avalonia 框架的基本功能。后续版本将集成 WebView 控件以支持完整的网页渲染。

### Q2: 为什么有些网站无法加载？

**A**: 可能的原因：
1. 网站需要 HTTPS 但输入的是 HTTP
2. 网站有反爬虫机制
3. 网络连接问题
4. 网站响应超时（30 秒）

**解决方法**：
- 确保使用正确的 URL 格式
- 尝试访问其他网站（如 Bing.com）
- 检查网络连接

### Q3: 如何调试加载问题？

**A**: 查看控制台输出，应用会打印错误信息：

```
加载页面失败: [错误信息]
获取页面标题失败: [错误信息]
```

### Q4: 支持哪些平台？

**A**: 支持 Windows、Linux 和 macOS（.NET 8.0 支持的所有平台）

### Q5: 如何发布为独立应用？

**A**:

Windows:
```bash
dotnet publish -c Release -r win-x64 --self-contained
```

Linux:
```bash
dotnet publish -c Release -r linux-x64 --self-contained
```

macOS:
```bash
dotnet publish -c Release -r osx-x64 --self-contained
```

## 测试建议

### 推荐测试网站

以下网站适合测试当前版本：

1. **Bing**: `https://www.bing.com` - 简单的搜索引擎
2. **Example.com**: `https://example.com` - 简单的测试页面
3. **Wikipedia**: `https://zh.wikipedia.org` - 结构化的内容
4. **GitHub**: `https://github.com` - 技术网站

### 不推荐的网站

以下网站可能无法正常加载：

1. **需要 JavaScript 的网站**（如现代 Web 应用）
2. **使用复杂 CSS 的网站**
3. **有反爬虫保护的网站**
4. **需要登录的网站**

## 后续开发方向

### 短期改进

1. **集成 WebView 控件**
   - 使用 Avalonia.WebView 或第三方 WebView
   - 支持完整的 HTML/CSS/JavaScript 渲染
   - 改进用户体验

2. **增强导航功能**
   - 完整的历史记录管理
   - 书签功能
   - 多标签页支持

3. **优化性能**
   - 页面缓存
   - 并发加载优化
   - 内存管理优化

### 长期规划

1. **AI Agent 集成**
   - 智能内容分析
   - 对话存档
   - 知识库构建

2. **高级功能**
   - 下载管理器
   - Cookie 管理
   - 用户设置持久化

3. **组件化重构**
   - 创建可复用的浏览器控件库
   - 插件化架构
   - SDK 开放

## 代码结构说明

### 文件说明

```
SimpleWebBrowserDemo/
├── Models/
│   └── BrowserState.cs          # 浏览器状态数据模型
├── ViewModels/
│   └── MainViewModel.cs         # 主窗口视图模型
├── Views/
│   ├── MainWindow.axaml         # 主窗口 XAML 界面
│   └── MainWindow.axaml.cs     # 主窗口后台代码
├── Services/
│   ├── NavigationService.cs     # 导航服务
│   └── WebPageService.cs      # 网页获取服务
├── App.axaml                   # 应用程序资源定义
├── App.axaml.cs                # 应用程序入口逻辑
├── Program.cs                  # 程序启动点
└── SimpleWebBrowserDemo.csproj # 项目配置文件
```

### 关键类说明

#### MainViewModel

主窗口的视图模型，负责：
- 管理浏览器状态（URL、标题、加载状态）
- 处理用户命令（前进、后退、刷新等）
- URL 规范化处理

#### NavigationService

导航服务，负责：
- URL 验证和规范化
- 历史记录管理（前进/后退栈）
- 导航状态跟踪

#### WebPageService

网页服务，负责：
- HTTP 请求管理
- 网页内容获取
- 页面标题提取

#### MainWindow

主窗口，负责：
- UI 渲染和布局
- 事件处理
- 页面内容显示

## 开发者指南

### 添加新功能

1. **在 ViewModel 中添加属性**

```csharp
[ObservableProperty]
private string _newProperty;

public string NewProperty
{
    get => _newProperty;
    set => SetProperty(ref _newProperty, value);
}
```

2. **在 ViewModel 中添加命令**

```csharp
[RelayCommand]
private void NewCommand()
{
    // 命令逻辑
}
```

3. **在 XAML 中绑定**

```xml
<TextBox Text="{Binding NewProperty}"/>
<Button Command="{Binding NewCommand}"/>
```

### 调试技巧

1. **启用详细日志**

在 `Program.cs` 中修改：

```csharp
.LogToTrace()
```

2. **使用 Avalonia DevTools**

在 `App.axaml.cs` 中启用：

```csharp
UseDeveloperTools = true;
```

3. **检查数据绑定**

在 XAML 中使用编译时绑定检查：

```xml
x:DataType="vm:MainViewModel"
```

## 总结

极简 Web Browser Demo 是一个功能完整的基础浏览器应用，展示了 Avalonia UI 框架的强大功能。虽然当前版本使用简化的网页加载方式，但架构清晰、代码规范，为后续开发更复杂的浏览器应用奠定了坚实基础。

**项目状态**: ✅ 可用
**编译状态**: ✅ 成功
**功能完整度**: ✅ 满足极简版本要求

---

**最后更新**: 2026-01-20
